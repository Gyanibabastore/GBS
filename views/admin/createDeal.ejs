<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('../partials/head', { title: "Gyanibaba Store Dashboard" }) %>
  <link href="/css/admin/createDeal.css" rel="stylesheet" />
</head>
<body>
  <!-- âœ… Admin Navbar Include -->
  <%- include('../partials/adminNavbar') %>
<div class="container py-4">
       <a href="/admin/dashboard" class="btn btn-warning my-3">â¬… Back to Dashboard</a>

  <h2 class="mb-4 text-center text-primary">ðŸ“¦ Create New Deal</h2>
  <form id="dealForm" method="POST" action="/admin/deals/create">
    
    <!-- Brand & Model Name in one row -->
    <div class="row">
      <div class="col-md-6 mb-3">
        <label for="brand" class="form-label">Brand</label>
        <input 
          type="text" 
          class="form-control" 
          id="brand" 
          name="brand"
          placeholder="e.g. Apple"
          required
        >
      </div>
      <div class="col-md-6 mb-3">
        <label for="modelName" class="form-label">Model Name</label>
        <input 
          type="text" 
          class="form-control" 
          id="modelName" 
          name="modelName"
          placeholder="e.g. iPhone 13"
          required
        >
      </div>
    </div>

    <!-- Variant & Color in one row -->
    <div class="row">
      <div class="col-md-6 mb-3">
        <label for="variant" class="form-label">Variant</label>
        <input 
          type="text" 
          class="form-control" 
          id="variant" 
          name="variant"
          placeholder="e.g. 128GB"
          required
        >
      </div>
      <div class="col-md-6 mb-3">
        <label for="color" class="form-label">Color</label>
        <input 
          type="text" 
          class="form-control" 
          id="color" 
          name="color"
          placeholder="e.g. Blue"
          required
        >
      </div>
    </div>

    <div class="mb-3">
      <label for="modelImage" class="form-label">Model Image Link</label>
      <input 
        type="url" 
        class="form-control" 
        id="modelImage" 
        name="modelImage"
        placeholder="Paste image URL here" 
        required
      >
    </div>

    <div class="mb-3">
      <label for="buyLink" class="form-label">Buy Now Link</label>
      <input 
        type="url" 
        class="form-control" 
        id="buyLink" 
        name="buyLink"
        placeholder="Paste buy link here" 
        required
      >
    </div>

    <div class="row">
      <div class="col-md-4 mb-3">
        <label for="bookingAmount" class="form-label">Booking Amount (â‚¹)</label>
        <input 
          type="number" 
          class="form-control" 
          id="bookingAmount" 
          name="bookingAmount"
          min="0"
          required
        >
      </div>
      <div class="col-md-4 mb-3">
        <label for="returnAmount" class="form-label">Return Amount (â‚¹)</label>
        <input 
          type="number" 
          class="form-control" 
          id="returnAmount" 
          name="returnAmount"
          min="0"
          required
        >
      </div>
      <div class="col-md-4 mb-3">
        <label for="margin" class="form-label">Buyer Margin (â‚¹)</label>
        <input 
          type="number" 
          class="form-control" 
          id="margin" 
          name="margin"
          min="0"
          required
        >
      </div>
    </div>

    <div class="row">
      <div class="col-md-6 mb-3">
        <label for="pincode" class="form-label">Pincode</label>
        <input 
          type="text" 
          class="form-control" 
          id="pincode" 
          name="pincode"
          pattern="^[0-9]{6}$"
          title="Enter a valid 6-digit pincode"
          required
        >
      </div>
      <div class="col-md-6 mb-3">
        <label for="address" class="form-label">Address</label>
        <input 
          type="text" 
          class="form-control" 
          id="address" 
          name="address"
          required
        >
      </div>
    </div>

    <div class="mb-3">
      <label for="cardWorking" class="form-label">Card Working (e.g. Visa, MasterCard)</label>
      <input 
        type="text" 
        class="form-control" 
        id="cardWorking" 
        name="cardWorking"
        required
      >
    </div>

    <!-- Status Toggle -->
    <div class="form-check form-switch mb-4">
      <input class="form-check-input" type="checkbox" id="status" name="status" checked>
      <label class="form-check-label" for="status">Active</label>
    </div>

    <button type="submit" class="btn btn-primary w-100">Create Deal</button>
  </form>
  <% if (deals.length > 0) { %>
  <div class="mt-5">
    <h4 class="mb-4 text-center text-secondary">ðŸ’¼ All Deals (Active & Inactive)</h4>
    <div class="row g-4">
      <% deals.forEach(deal => { %>
        <div class="col-md-4">
          <div class="card h-100 shadow-lg border-0 position-relative" style="transition: transform 0.2s ease;">
            <img src="<%= deal.imageUrl %>" class="card-img-top rounded-top" style="object-fit: cover; height: 200px;" alt="Model Image">
            <div class="card-body">
              <h5 class="card-title fw-bold"> <%= deal.brand %>&nbsp;<%= deal.deviceName %> - <%= deal.variant %></h5>
              <p class="text-muted mb-1">Brand: <strong><%= deal.brand %></strong></p>
              <p class="mb-1">Color: <%= deal.color %> | Card: <%= deal.cardWorking %></p>
              <p class="mb-1">Booking: â‚¹<%= deal.bookingAmount %> | Return: â‚¹<%= deal.returnAmount %></p>
              <p class="mb-2">Margin: â‚¹<%= deal.margin %></p>
              <p class="mb-3">
                <a href="<%= deal.buyLink %>" target="_blank" class="btn btn-sm btn-outline-primary">ðŸ”— Buy Now</a>
              </p>

              <!-- Toggle -->
              <div class="d-flex align-items-center justify-content-between">
                <div class="form-check form-switch">
                  <input 
                    class="form-check-input toggle-status" 
                    type="checkbox" 
                    data-id="<%= deal._id %>" 
                    id="toggle-<%= deal._id %>"
                    <%= deal.status === 'active' ? 'checked' : '' %>
                  >
                  <label class="form-check-label ms-2" for="toggle-<%= deal._id %>">
                    <%= deal.status === 'active' ? 'ðŸŸ¢ Active' : 'ðŸ”´ Inactive' %>
                  </label>
                </div>
                <span class="badge <%= deal.status === 'active' ? 'bg-success' : 'bg-danger' %>">
                  <%= deal.status %>
                </span>
              </div>
            </div>
          </div>
        </div>
      <% }) %>
    </div>
  </div>
<% } %>
</div>
 



<script src="/js/admin/createDeal.js"></script>
</body>
</html>
