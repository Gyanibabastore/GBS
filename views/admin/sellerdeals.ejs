<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('../partials/head', { title: "Gyanibaba Store Dashboard" }) %>
  <link href="/css/admin/sellerdeals.css" rel="stylesheet" />
  <script src="/js/admin/sellerdeals.js" defer></script>
</head>
<body>

  <%- include('../partials/adminNavbar') %>
  <div class="container py-5">
    <a href="/admin/dashboard" class="btn btn-warning my-3">‚¨Ö Back to Dashboard</a>
    <h2 class="mb-4">üì¶ Manage Stocks</h2>

   <div id="product-list" class="row">
  <% for (let i = 0; i < products.length; i++) {
    const product = products[i];
  %>
  <div class="col-md-6 col-lg-4 product-card" style="<%= i >= 6 ? 'display: none;' : '' %>">
    <div class="card p-3 mb-4">
      <img src="<%= product.imageUrl %>" class="card-img-top rounded" alt="<%= product.deviceName %>" />
      <div class="card-body">
        <h5 class="card-title"><%= product.brand %> &nbsp;<%= product.deviceName %></h5>
        <h5 class="mb-3 text-muted">Available: <%= product.availableCount %> pcs</h5>

        <p>
          Brand: <%= product.brand %><br />
          Variant: <%= product.variant %><br />
          Color: <%= product.color %><br />
          Return Amount: ‚Çπ<%= product.returnAmount %><br />
          Status:
          <% if (product.deal) { %>
            <span class="badge bg-success">Active</span>
          <% } else { %>
            <span class="badge bg-secondary">Inactive</span>
          <% } %>
        </p>

        <div class="mb-3">
          <label for="margin-<%= i %>" class="form-label">Add Margin (‚Çπ)</label>
          <input type="number" id="margin-<%= i %>" class="form-control" value="<%= product.bookingAmountSeller ? product.bookingAmountSeller - product.returnAmount : '' %>">
        </div>

        <div class="form-check form-switch">
          <input class="form-check-input deal-toggle" type="checkbox"
            data-index="<%= i %>"
            data-stockid="<%= product._id %>"
            data-return="<%= product.returnAmount %>"
            <%= product.deal ? 'checked' : '' %>
            <%= product.availableCount === 0 ? 'disabled' : '' %>>
          <label class="form-check-label">Toggle Stock</label>
        </div>

        <% if (product.availableCount === 0) { %>
          <small class="text-danger">‚ùå Cannot activate deal ‚Äî Stock is 0</small>
        <% } %>
      </div>
    </div>
  </div>
  <% } %>
</div>

<!-- Load More Button -->
<div class="text-center mt-4">
  <button id="loadMoreBtn" class="btn btn-primary">Load More</button>
</div>

  </div>
</body>
</html>
